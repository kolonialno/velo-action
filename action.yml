---
name: Velo
author: Oda
description: Velo
inputs:
  version:
    description: Version to tag image with. This will overwrite the automatically generated gitversion.
    required: false
    default: None

  octopus_project:
    description: Name of the project in Octopus Deploy
    required: true
    default: None

  environments:
    description: The environment(s) to deploy the release to. String with environment names seperated by a comma. Example 'staging,prod'.
    required: false
    default: None

  octopus_tenants:
    description: Tenants to deploy the release to. String with tenant names seperated by a comma. Example 'fc:osl1,fc:rd1'
    required: false
    default: None

  service_account_key:
    description: |-
      A Google Service account key to use for authentication. This should be the JSON
      formatted private key which can be exported from the Cloud Console.
    required: false
    default: None

  python_logging_level:
    description: |-
      Python Logging level. Can be any of CRITICAL, FATAL, ERROR, WARN, WARNING, INFO, DEBUG.
    required: false
    default: INFO

  create_release:
    description: |-
      Create a release on Octopus Deploy and save artifacts in the Velo Artifacts bucket.
    required: false
    default: 'False'

  deploy:
    description: |-
      Deploy a Octopus release. If this is set to true 'create_release' is set to True.
    required: false
    default: 'False'

  octopus_cli_server_secret:
    description: |-
      Name of the GCP secret containing the Octopus Deploy server url.
    required: false
    default: 'velo_action_octopus_server'

  octopus_cli_api_key_secret:
    description: |-
      Name of the GCP secret containing the Octopus Deploy api key.
    required: false
    default: 'velo_action_octopus_api_key'

  velo_artifact_bucket_secret:
    description: |-
      Name of the GCP secret containing the name of the Velo actifact bucket.
    required: false
    default: 'velo_action_artifacts_bucket_name'

outputs:
  version:
    description: |-
      Version string.

runs:
  using: docker
  image: docker://odacom/velo-action:0.1.3-beta-1
  args:
    - ${{ inputs.version }}
    - ${{ inputs.create_release }}
    - ${{ inputs.deploy }}
    - ${{ inputs.service_account_key }}
    - ${{ inputs.octopus_project }}
    - ${{ inputs.octopus_tenants }}
    - ${{ inputs.octopus_cli_server_secret }}
    - ${{ inputs.octopus_cli_api_key_secret }}
    - ${{ inputs.velo_artifact_bucket_secret }}

branding:
  icon: award
  color: green
